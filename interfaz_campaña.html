<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registrar Campa√±a</title>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" />
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="navbar.css" />
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
    }

    .background {
      padding-top: 60px; /* Empuja el contenido debajo del header */
      position: relative;
    }

    .container {
      background-color: rgba(255, 255, 255, 0.95);
      padding: 30px;
      max-width: 600px;
      margin: auto;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }

    .boton-atras {
      display: inline-block;
      margin: 80px;
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      transition: background-color 0.3s ease;
      top: 10px;
  left: 10px;
  z-index: 999;
  position: absolute;
 
    }

    .boton-atras:hover {
      background-color: #0056b3;
    }

    .grupo-rol {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .titulo-rol {
      width: 100px;
      font-weight: bold;
    }

    .radio-group {
      display: flex;
      gap: 20px;
    }

    .radio-group label {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* Navbar */
    .navbar {
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.6);
  z-index: 1000;
  border-radius: 30px;
  padding: 12px 30px;
  width: 95%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-family: sans-serif;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease;
}
.navbar {
  transition: transform 0.3s ease;
}
    .navbar-title {
      font-weight: bold;
      font-size: 1.2rem;
      color: #000;
    }

    .navbar-links {
      display: flex;
      gap: 25px;
    }

    .navbar-links a {
      text-decoration: none;
      color: #007bff;
      font-weight: 600;
      padding: 8px 16px;
      border-radius: 20px;
      transition: all 0.3s ease;
    }

    .navbar-links a:hover,
    .navbar-links a.active {
      background-color: #007bff;
      color: white;
    }

    .hidden {
      display: none;
    }

    .boton {
      margin-top: 20px;
      padding: 12px;
      background-color: #0056b3;
      border: none;
      color: white;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 100%;
    }

    .boton:hover {
      background-color: #004199;
    }


#resultados td, #resultados th {
  padding: 6px;
  border: 1px solid #ccc;
  text-align: left;
  cursor: default;
}

#resultados button {
  font-size: 0.8rem;
  padding: 4px 8px;
  margin: 0 2px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
.editar-btn {
  background-color: #28a745;
  color: white;
}
.eliminar-btn {
  background-color: #dc3545;
  color: white;
}
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
.fila-activa {
  background-color: #d4f8d4 !important;
}
    .container {
      background-color: rgba(255, 255, 255, 0.95);
      padding: 30px;
      max-width: 800px;
      margin: 60px auto;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
    }

    h2 {
      text-align: center;
      color: #003366;
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }

    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .boton {
      margin-top: 20px;
      background-color: #005bb5;
      color: white;
      padding: 10px;
      border: none;
      width: 100%;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    .boton:hover {
      background-color: #004080;
    }

    #tablaCampanias {
      margin-top: 30px;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid #bbb;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #e6f0ff;
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="navbar-title">Municipalidad de Huaraz</div>
    <nav class="navbar-links">
      <a href="registro_personas.html">Registrar Propietario o Veterinario</a>
      <a href="registro_mascotas.html">Registro de Mascotas</a>
      <a href="interfaz_campa√±a.html">Registro/creacion de Campa√±as</a>
      <a href="#ubicacion">Registro de Medicamentos</a>
    </nav>
  </header>
  <div class="background">
 <a href="main_menu.html" class="boton-atras">‚Üê Atr√°s</a>

  <div class="container">
    <img src="imagenes/logo2muni.png" alt="Logo" style="width:450px; height:auto; margin: 0 auto 20px; display: block;" />
    <h2>Registrar Campa√±a</h2>

    <form id="campaniaForm">
      <input type="hidden" id="id" name="id" />

      <label for="nombre">Nombre de la campa√±a:</label>
      <input type="text" id="nombre" name="nombre" required />

      <label for="lugar">Lugar:</label>
      <input type="text" id="lugar" name="lugar" required />

      <label for="fecha">Fecha:</label>
      <input type="date" id="fecha" name="fecha" required />
      
      <!-- Combobox de tratamientos -->
<label for="tratamientoCombo">Seleccionar procedimiento:</label>
<select id="tratamientoCombo" style="width: 100%; margin-bottom: 10px;"></select>

<!-- Tabla din√°mica de tratamientos seleccionados -->
<h4>Procedimientos seleccionados:</h4>
<table id="tablaProcedimientos" border="1" width="100%">
  <thead>
    <tr><th>Nombre</th><th>Acci√≥n</th></tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Bot√≥n para guardar -->
<button type="submit" class="boton">Guardar</button>
</form>

<!-- Bot√≥n para ver/ocultar campa√±as -->
<button type="button" class="boton" onclick="mostrarTabla()">Ver campa√±as registradas</button>

<!-- Panel de campa√±as registradas -->
<div id="tablaCampanias" style="display: none;">
  <h3>üìã Lista de Campa√±as</h3>

  <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
    <div style="flex: 1;">
      <label for="busqueda">üîç Buscar campa√±as:</label>
      <input type="text" id="busqueda" placeholder="Escribe un nombre o lugar..." style="width: 100%;" />
    </div>

    <div style="flex: 0 0 250px;">
      <label for="orden">Ordenar por:</label>
      <select id="orden" style="width: 100%;">
        <option value="nombre">Nombre</option>
        <option value="estado">Estado</option>
        <option value="fecha">Fecha</option>
      </select>
    </div>
  </div>

  <div id="contenidoCampanias" style="margin-top: 20px;">Cargando...</div>
</div>
<!-- Script de l√≥gica -->
<script>
  const seleccionados = new Set();

  $(document).ready(function () {
    cargarProcedimientos();
    listarCampanias();

    // Filtros autom√°ticos
    $("#busqueda").on("input", function () {
      listarCampanias($("#busqueda").val(), $("#orden").val());
    });

    $("#orden").on("change", function () {
      listarCampanias($("#busqueda").val(), $(this).val());
    });

    // Evento √∫nico para guardar campa√±a
    $("#campaniaForm").off("submit").on("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(this);
      const tratamientos = Array.from(seleccionados);
      formData.append("tratamientos_txt", JSON.stringify(tratamientos));
      formData.append("accion", $("#id").val() ? "editar" : "crear");

      const btn = $(this).find("button[type='submit']");
      btn.prop("disabled", true).text("Guardando...");

      $.ajax({
        url: "logica_campa√±a.php",
        method: "POST",
        data: formData,
        processData: false,
        contentType: false,
        success: function () {
          alert("‚úÖ Campa√±a guardada correctamente");
          location.reload();
        }
      });
    });

    // Al seleccionar procedimiento
    $("#tratamientoCombo").change(function () {
      const nombre = $(this).val();
      if (nombre && !seleccionados.has(nombre)) {
        seleccionados.add(nombre);
        $("#tablaProcedimientos tbody").append(`
          <tr data-nombre="${nombre}">
            <td>${nombre}</td>
            <td><button onclick="eliminarProcedimiento('${nombre}')">üóëÔ∏è</button></td>
          </tr>
        `);
      }
      $(this).val("");
    });
  });

  function eliminarProcedimiento(nombre) {
    seleccionados.delete(nombre);
    $(`#tablaProcedimientos tbody tr[data-nombre="${nombre}"]`).remove();
  }

  function cargarProcedimientos() {
    $.get("logica_campa√±a.php", { accion: "listar_procedimientos" }, function (data) {
      const procs = JSON.parse(data);
      $("#tratamientoCombo").html('<option value="">Seleccione...</option>');
      procs.forEach(p => {
        $("#tratamientoCombo").append(`<option value="${p.nombre}">${p.nombre}</option>`);
      });
    });
  }

  function listarCampanias(busqueda = "", orden = "nombre") {
    $.get("logica_campa√±a.php", {
      accion: "listar",
      busqueda: $("#busqueda").val(),
      orden: $("#orden").val()
    }, function (html) {
      $("#contenidoCampanias").html(html);
    });
  }

  function mostrarTabla() {
    const contenedor = $("#tablaCampanias");
    contenedor.is(":visible") ? contenedor.slideUp() : contenedor.slideDown();
    if (!contenedor.is(":visible")) {
      listarCampanias();
    }
  }

  function editarCampania(id) {
    $.get("logica_campa√±a.php", { accion: "obtener", id }, function (data) {
      const camp = JSON.parse(data);
      $("#id").val(camp.id);
      $("#nombre").val(camp.nombre);
      $("#lugar").val(camp.lugar);
      $("#fecha").val(camp.fecha);
      $("#campaniaForm button[type='submit']").text("Guardar actualizaci√≥n");

      seleccionados.clear();
      $("#tablaProcedimientos tbody").empty();
      camp.tratamientos_nombres.forEach(nombre => {
        seleccionados.add(nombre);
        $("#tablaProcedimientos tbody").append(`
          <tr data-nombre="${nombre}">
            <td>${nombre}</td>
            <td><button onclick="eliminarProcedimiento('${nombre}')">üóëÔ∏è</button></td>
          </tr>
        `);
      });

      $("html, body").animate({ scrollTop: 0 }, "slow");
    });
  }

  function eliminarCampania(id) {
    if (confirm("¬øSeguro de eliminar?")) {
      $.post("logica_campa√±a.php", { accion: "eliminar", id }, function () {
        listarCampanias();
      });
    }
  }
</script>
  <script>
  let ultimoScroll = 0;
  const navbar = document.querySelector('.navbar');

  window.addEventListener('scroll', () => {
    const scrollActual = window.pageYOffset || document.documentElement.scrollTop;

    if (scrollActual > ultimoScroll) {
      // Scroll hacia abajo ‚Üí ocultar
      navbar.style.transform = 'translate(-50%, -120%)';
    } else {
      // Scroll hacia arriba ‚Üí mostrar
      navbar.style.transform = 'translate(-50%, 0)';
    }

    ultimoScroll = scrollActual <= 0 ? 0 : scrollActual; // evitar valores negativos
  });

const camposOrdenados = [
  'dniInput',
  'nombresInput',
  'apellido1Input',
  'apellido2Input',
  'telefonoInput',
  'generoPSelect'
];

// Activar navegaci√≥n con flecha ‚Üì
camposOrdenados.forEach((id, index) => {
  const campo = document.getElementById(id);
  if (!campo) return;

  campo.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      const siguienteId = camposOrdenados[index + 1];
      if (siguienteId) {
        const siguienteCampo = document.getElementById(siguienteId);
        siguienteCampo?.focus();
      }
    }
  });
});
</script>
</body>
</html>
